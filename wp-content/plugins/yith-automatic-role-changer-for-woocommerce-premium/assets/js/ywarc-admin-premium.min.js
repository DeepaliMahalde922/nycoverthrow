jQuery(document).ready(function(a){"use strict";function g(d,e){var f=a(d),g=f.data("rule_id"),i=f.find(".rule_head"),j=f.find(".rule_options"),k=i.find("label.rule_title").text();e&&(b.append(f),j.show(),h()),i.on("click",function(a){j.slideToggle()}),f.trigger("init_tooltips");var l=j.find("div.role_selector_block"),m=j.find("div.rule_radio_group"),n=j.find("div.specific_product_block");n.hide();var o=j.find("div.specific_range_block");o.hide();var p=j.find("div.specific_taxonomy_block");p.hide();var q=p.find("div.category_search_block");q.hide();var r=p.find("div.tag_search_block");r.hide();var s=j.find("div.date_range_block");s.hide();var t=j.find("div.duration_block");t.hide();var u=j.find("div.role_filter_selector_block");u.hide();var v=j.find("div.submit_block");v.hide();var w=o.find('input[name="price_range_from"]'),x=o.find('input[name="price_range_to"]'),y=s.find(".sale_price_dates_from"),z=s.find(".sale_price_dates_to"),A=t.find(".ywarc_duration"),B=function(a){"role_selector"!=a&&"all"!=a||l.removeClass("empty_field"),"product_selector"!=a&&"all"!=a||n.removeClass("empty_field"),"price_range"!=a&&"all"!=a||(o.removeClass("empty_field"),o.removeClass("ywarc_from_gt_to")),"category"!=a&&"all"!=a||(q.removeClass("empty_field"),p.removeClass("empty_field")),"tag"!=a&&"all"!=a||(r.removeClass("empty_field"),p.removeClass("empty_field"))};w.on("change",function(){B("price_range")}),x.on("change",function(){B("price_range")}),j.find(".sale_price_dates_fields").each(function(){var b=a(this).find("input").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,onSelect:function(c){var d=a(this).is(".sale_price_dates_from")?"minDate":"maxDate",e=a(this).data("datepicker"),f=a.datepicker.parseDate(e.settings.dateFormat||a.datepicker._defaults.dateFormat,c,e.settings);b.not(this).datepicker("option",d,f)}})}),j.find("input.ywarc_rule_radio_button").change(function(){B("all");var a=j.find("input.ywarc_rule_radio_button:checked");"product"==a.val()?(o.hide(),p.hide(),n.slideDown(),s.slideDown(),t.slideDown(),u.slideDown(),v.slideDown()):"range"==a.val()?(n.hide(),p.hide(),o.slideDown(),s.slideDown(),t.slideDown(),u.slideDown(),v.slideDown()):"taxonomy"==a.val()&&(n.hide(),o.hide(),p.slideDown(),s.slideDown(),t.slideDown(),u.slideDown(),v.slideDown())}).change(),p.find("input.ywarc_tax_radio_button").change(function(){B("all");var a=p.find("input.ywarc_tax_radio_button:checked");"category"==a.val()?(r.hide(),q.show()):"tag"==a.val()&&(q.hide(),r.show())}).change();var C;C=localize_js_ywarc_admin.before_2_7?{maximumSelectionSize:1}:{maximumSelectionLength:1},j.find(".ywarc_role_selector").select2(C).on("change",function(){B("role_selector")}),u.find(".role_filter_selector").select2(),a(document.body).trigger("wc-enhanced-select-init"),a(":input.wc-product-search").on("change",function(){B("product_selector")});var D=function(b){var c=[];return b&&a.each(b,function(a,b){c.push({id:a,text:b})}),{results:c}},E=function(b,c){var d=a.parseJSON(b.attr("data-selected")),e=[];return a(b.val().split(",")).each(function(a,b){e.push({id:b,text:d[b]})}),c(e)},F=function(a){return'<div class="selected-option" data-id="'+a.id+'">'+a.text+"</div>"};a(":input.ywarc-category-search").filter(":not(.enhanced)").each(function(){var b={url:localize_js_ywarc_admin.ajax_url,dataType:"json",quietMillis:250,data:function(a){return{term:a,action:"ywarc_category_search",security:localize_js_ywarc_admin.search_categories_nonce}},cache:!0};localize_js_ywarc_admin.before_2_7?b.results=D:b.processResults=D;var c={initSelection:localize_js_ywarc_admin.before_2_7?E:null,formatSelection:localize_js_ywarc_admin.before_2_7?F:null,multiple:a(this).data("multiple"),allowClear:!!a(this).data("allow_clear"),placeholder:a(this).data("placeholder"),minimumInputLength:a(this).data("minimum_input_length")?a(this).data("minimum_input_length"):"3",escapeMarkup:function(a){return a},ajax:b};a(this).select2(c).addClass("enhanced").on("change",function(){B("category")})}),a(":input.ywarc-tag-search").filter(":not(.enhanced)").each(function(){var b={url:localize_js_ywarc_admin.ajax_url,dataType:"json",quietMillis:250,data:function(a){return{term:a,action:"ywarc_tag_search",security:localize_js_ywarc_admin.search_tags_nonce}},cache:!0};localize_js_ywarc_admin.before_2_7?b.results=D:b.processResults=D;var c={initSelection:localize_js_ywarc_admin.before_2_7?E:null,formatSelection:localize_js_ywarc_admin.before_2_7?F:null,multiple:a(this).data("multiple"),allowClear:!!a(this).data("allow_clear"),placeholder:a(this).data("placeholder"),minimumInputLength:a(this).data("minimum_input_length")?a(this).data("minimum_input_length"):"3",escapeMarkup:function(a){return a},ajax:b};a(this).select2(c).addClass("enhanced").on("change",function(){B("tag")})});var G=v.find("input");G.on("click",function(b){b.preventDefault(),f.block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var d=j.find("select.ywarc_role_selector").val(),i=j.find("input.ywarc_rule_radio_button:checked").val(),s=n.find(':input[id^="ywarc_product_selector"]').val(),t=w.val(),v=x.val(),B=p.find("input.ywarc_tax_radio_button:checked").val(),C=q.find(':input[id^="ywarc_category_selector"]').val(),D=r.find(':input[id^="ywarc_tag_selector"]').val(),E=y.val(),F=z.val(),G=A.val(),H=u.find("select.role_filter_selector").val(),I=!0;if(d||(I=!1,l.addClass("empty_field")),"product"==i?s||(I=!1,n.addClass("empty_field")):"range"==i?(t||v||(I=!1,o.addClass("empty_field")),v&&parseInt(t)>=parseInt(v)&&(I=!1,o.addClass("ywarc_from_gt_to"))):"taxonomy"==i?"category"==B?C||(I=!1,q.addClass("empty_field")):"tag"==B?D||(I=!1,r.addClass("empty_field")):(I=!1,p.addClass("empty_field")):(I=!1,m.addClass("empty_field")),I){G=parseInt(G,10),G=G>0?G:"";var J={action:"ywarc_save_rule",title:k,rule_id:g,role_selected:d,radio_group:i,product_selected:"product"==i?s:"",price_range_from:"range"==i?t:"",price_range_to:"range"==i?v:"",tax_radio_group:"taxonomy"==i?B:"",categories_selected:"taxonomy"==i&&"category"==B?C:"",tags_selected:"taxonomy"==i&&"tag"==B?D:"",date_from:E,date_to:F,duration:G,role_filter:H};a.post(localize_js_ywarc_admin.ajax_url,J,function(b){f.unblock(),e&&(c.append(f),j.hide(),e=!1),c.find(".rule_block").length>0&&a("#my_rules_header").removeClass("no_rules"),h()})}else f.unblock();h()});var H=v.find("a.delete_rule");H.on("click",function(b){b.preventDefault();var d=confirm(localize_js_ywarc_admin.delete_rule_msg);if(1==d){if(e)f.remove();else{f.block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var i={action:"ywarc_delete_rule",rule_id:g};a.post(localize_js_ywarc_admin.ajax_url,i,function(b){f.unblock(),f.remove(),0==c.find(".rule_block").length&&a("#my_rules_header").addClass("no_rules")})}0==c.find(".rule_block").length&&a("#my_rules_header").addClass("no_rules")}h()})}function h(){b.find(".rule_block").length>0?a("#ywarc_new_rules_row").removeClass("no_rules"):a("#ywarc_new_rules_row").addClass("no_rules")}var b=a(document).find(".ywarc_new_rules"),c=a(document).find(".ywarc_rules_group"),d=a("#yith_ywarc_add_rule_button"),e=a(".ywarc_new_rule_title"),f=a(".ywarc_creating_rule");e.focus(),e.keydown(function(a){13==a.which&&(d.focus(),d.trigger("click"))}),d.on("click",function(c){c.preventDefault();var d=e.val().trim(),h=[];b.find(".rule_title").each(function(){h.push(a(this).text())}),"-1"!=a.inArray(d,h)?(alert(localize_js_ywarc_admin.duplicated_name_msg),e.val(""),e.focus()):""==d?(alert(localize_js_ywarc_admin.empty_name_msg),e.focus()):(f.block({message:null,overlayCSS:{background:"#f1f1f1",opacity:.6}}),a.post(localize_js_ywarc_admin.ajax_url,{action:"ywarc_add_rule",title:d},function(a){if(f.unblock(),e.val(""),"duplicated_name_error"===a)alert(localize_js_ywarc_admin.duplicated_name_msg),e.focus();else{var b=!0;g(a,b)}}))}),a(".rule_block").each(function(a,b){g(b,!1)}),a("#show_all_rules").on("click",function(a){a.preventDefault(),c.find(".rule_options").slideDown()}),a("#hide_all_rules").on("click",function(a){a.preventDefault(),c.find(".rule_options").slideUp()}),a("#delete_all_rules").on("click",function(b){b.preventDefault();var d=confirm(localize_js_ywarc_admin.delete_all_rules_msg);1==d&&(f.block({message:null,overlayCSS:{background:"#f1f1f1",opacity:.6}}),a.post(localize_js_ywarc_admin.ajax_url,{action:"ywarc_delete_all_rules"},function(b){f.unblock(),c.find(".rule_block").remove(),a("#my_rules_header").addClass("no_rules")})),h()})});